<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Login</title>
    <style>
        .ok { color: green; }
        .error { color: red; }
    </style>
    <link rel="stylesheet" href="static/css/login.css">
</head>
<body>

<div class="login-container">
    <h2>Iniciar Sesi√≥n</h2>

    <form action="/ingresar" method="POST" id="formLogin">

        <!-- USUARIO -->
        <input type="text" name="usuario" id="usuario" placeholder="Usuario">
        <span id="msgUsuario"></span>
        <br>

        <!-- CONTRASE√ëA -->
        <input type="password" name="contrase√±a" id="contrase√±a" placeholder="Contrase√±a">
        <span id="msgPassword"></span>
        <br>

        <!-- BOT√ìN DESACTIVADO -->
        <button type="submit" id="btnIngresar">Ingresar</button>
    </form>

    {% if error %}
<div class="alerta-error">
    {{ error }}
</div>
{% endif %}

    <p>¬øNo tienes cuenta? 
        <a href="/registro" class="gold-link">Reg√≠strate aqu√≠</a>
    </p>
</div>

<script>
// Obtener referencias
const usuarioInput = document.getElementById("usuario");
const passInput = document.getElementById("contrase√±a");
const btnIngresar = document.getElementById("btnIngresar");
const msgUsuario = document.getElementById("msgUsuario");

// üîí DESACTIVAR BOT√ìN AL INICIO
btnIngresar.disabled = true;
btnIngresar.style.opacity = "0.6";
btnIngresar.style.cursor = "not-allowed";

// üü° Funci√≥n que ACTIVAR√Å o DESACTIVAR√Å el bot√≥n
function actualizarBoton() {
    const usuarioClass = msgUsuario.className;
    const pass = passInput.value.trim();

    if (usuarioClass === "ok" && pass !== "") {
        btnIngresar.disabled = false;
        btnIngresar.style.opacity = "1";
        btnIngresar.style.cursor = "pointer";
    } else {
        btnIngresar.disabled = true;
        btnIngresar.style.opacity = "0.6";
        btnIngresar.style.cursor = "not-allowed";
    }
}

// üü° Validar usuario en tiempo real
usuarioInput.addEventListener("input", function() {
    let usuario = this.value.trim();

    if (usuario === "") {
        msgUsuario.textContent = "";
        msgUsuario.className = "";
        actualizarBoton();
        return;
    }

    fetch("/validar_usuario_login?usuario=" + usuario)
    .then(res => res.json())
    .then(data => {
        if (data.existe) {
            msgUsuario.textContent = "‚úî Usuario v√°lido";
            msgUsuario.className = "ok";
        } else {
            msgUsuario.textContent = "‚ùå Usuario no registrado";
            msgUsuario.className = "error";
        }

        actualizarBoton();
    });
});

// üü° Validar contrase√±a (solo revisa si est√° vac√≠a)
passInput.addEventListener("input", actualizarBoton);

</script>


</body>
</html>
